---
import MainLayout from "../layouts/MainLayout.astro";
---

<MainLayout>
	<div class="home-container">
		<div id="three-container"></div>
		<h1 class="main-h1">Bienvenid@</h1>
		<div class="cols">
			<div class="col-left">
				<div class="hero-img">
					<img
						src="./images/home/profile-crop2.png"
						alt="Imagen hero"
					/>
				</div>
			</div>
			<div class="col-right">
				<p class="hero-text">
					Este es mi sitio web, sentite bienvenid@ de ver mis
					trabajos. Aquí publico mis pensamientos acerca de la
					realidad de ser Artista y también subo mis obras a mi
					galería de arte web. Podés visualizar mi CV para conocer mi
					experiencia y si querés saber más sobre mí entrá a la
					sección "Bio".
				</p>
				<a href="/trabajos" class="hero-button">Ver trabajos</a>
			</div>
		</div>
	</div>
</MainLayout>

<style>
	#three-container {
		width: 100%;
		height: 300px;
		position: relative;
		z-index: 1;
	}
	.main-h1 {
		text-align: center;
		font-size: 3rem;
		font-family: "DynaPuff", system-ui;
		color: var(--main-color);
	}

	.home-container {
		animation: appear 1s ease;
		display: flex;
		flex-direction: column;
		justify-content: center;
	}

	.home-container h1 {
		margin-bottom: 1rem;
	}

	@keyframes appear {
		0% {
			opacity: 0;
			transform: translateY(1rem);
		}
		100% {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.hero-text {
		margin-top: 1.2rem;
		text-align: center;
		max-width: 40rem;
		padding-left: 2rem;
		padding-right: 2rem;
		text-indent: 0.4rem;
		margin-left: auto;
		margin-right: auto;
	}

	.hero-button {
		display: block;
		width: fit-content;
		background-color: var(--secondary-color);
		padding: 0.5rem 0.8rem;
		border-radius: 0.5rem;
		margin-top: 1rem;
		margin-left: auto;
		margin-right: auto;
		text-align: center;
		cursor: pointer;
		color: black;
		text-decoration: none;
		font-weight: 500;
		transition: opacity;
		animation: atention 4s ease infinite;
	}

	@keyframes atention {
		0% {
			filter: brightness(1);
		}
		50% {
			filter: brightness(1);
		}
		60% {
			filter: brightness(1.5);
		}
		50% {
			filter: brightness(1);
		}
	}

	.hero-img {
		display: flex;
		justify-content: center;
	}

	.hero-img img {
		max-width: 100%;
		width: 15rem;
		object-fit: cover;
		border: 4px solid var(--main-color);
		border-radius: 100%;
	}

	@media screen and (min-width: 765px) {
		.cols {
			display: flex;
			justify-content: center;
			align-items: flex-start;
		}

		.col-left {
			margin: 2rem;
		}

		.col-right {
			margin: 2rem;
		}

		.hero-button {
			margin-left: 0;
		}

		.hero-text {
			margin: 0;
			padding: 0;
		}

		.hero-text {
			text-align: left;
		}
	}
</style>

<script>
	import * as THREE from "three";
	import { GLTFLoader } from "three/examples/jsm/loaders/GLTFLoader.js";

	const container = document.getElementById("three-container")!;
	const scene = new THREE.Scene();

	const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
	renderer.setPixelRatio(window.devicePixelRatio);
	renderer.setSize(container.clientWidth, container.clientHeight);
	container.appendChild(renderer.domElement);

	const camera = new THREE.PerspectiveCamera(
		75,
		container.clientWidth / container.clientHeight,
		0.1,
		1000,
	);
	camera.position.z = 5;

	const light = new THREE.DirectionalLight(0xffffff, 2);
	light.position.set(5, 5, 5);
	scene.add(light);
	scene.add(new THREE.AmbientLight(0xffffff, 0.5));

	const loader = new GLTFLoader();
	let model: any;

	loader.load(
		"/models/corazon-realista.glb",
		(gltf) => {
			model = gltf.scene;

			const box = new THREE.Box3().setFromObject(model);
			const size = box.getSize(new THREE.Vector3());
			const center = box.getCenter(new THREE.Vector3());

			model.position.sub(center);

			const maxDim = Math.max(size.x, size.y, size.z);
			const fov = camera.fov * (Math.PI / 180);
			let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));

			cameraZ *= 1.5;

			camera.position.z = cameraZ;

			scene.add(model);
		},
		undefined,
		(error) => {
			console.error("Error cargando el modelo:", error);
		},
	);

	window.addEventListener("resize", () => {
		camera.aspect = container.clientWidth / container.clientHeight;
		camera.updateProjectionMatrix();
		renderer.setSize(container.clientWidth, container.clientHeight);
	});

	function animate() {
		requestAnimationFrame(animate);
		if (model) {
			model.rotation.y += 0.01;
		}
		renderer.render(scene, camera);
	}

	animate();
</script>
